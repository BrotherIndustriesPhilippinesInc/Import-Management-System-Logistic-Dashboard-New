@model IEnumerable<LogisticDashboard.Core.ContainerVisualization>

@{
    ViewData["Title"] = "Container Visualization";
}

<div class="mt-4">
    <div class="misc-color px-3 py-3 d-inline-flex mb-2 rounded align-items-center gap-2">
        <span class="text-light fs-2 fw-bold">Container Visalization</span>
    </div>
</div>

<div>
    <input type="file" id="uploadInput" class="d-none" />
    <button class="sea-freight-controls d-flex align-items-end" type="button" onclick="document.getElementById('uploadInput').click();">
        <i class="fa-solid fa-upload" style="font-size: 32px; color: black;"></i>
        Upload data
    </button>
</div>

<div>
    <h3 class="fw-bold">Container Size</h3>
    <div>
        <img id="containerImage" />
    </div>
</div>


<div class="modal fade" id="updateImageModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5" id="exampleModalLabel">Add Leadtime</h1>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="form-floating mb-3">
                    <input type="text" class="form-control" id="type" placeholder="LCL">
                    <label for="type">Flow Type</label>
                </div>

                <div class="input-group mb-3">
                    <input type="file" class="form-control" id="pictureInput">
                </div>


            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button id="update" type="button" class="btn btn-primary">
                    Update
                </button>
            </div>
        </div>
    </div>
</div>


@section Scripts {
    <script>
        $(async function () {
            try {
                const response = await fetch("https://localhost:7019/api/ContainerVisualizations/get_picture", {
                    method: "GET"
                });

                if (!response.ok) throw new Error("Failed to fetch data");

                const data = await response.json();
                console.log(data);

                // Example: display the images
                if (data.container_Image_Link)
                    $("#containerImage").attr("src", "https://localhost:7019/" + data.container_Image_Link);


            } catch (error) {
                console.error("Error loading mode of shipments:", error);
            }

            $('#uploadInput').on('change', function () {
                const file = this.files[0];

                if (!file) {
                    console.warn('No file selected.');
                    return;
                }

                const formData = new FormData();
                formData.append('file', file);

                $.ajax({
                    url: `https://localhost:7019/api/ContainerVisualizations/upload`, // 🔥 Replace with your actual API route
                    type: 'POST',
                    data: formData,
                    processData: false,
                    contentType: false,
                    success: function (response) {
                        console.log('Upload success:', response);
                        // 😎 Do your success handling here (toast, reload, etc.)
                        alert('Upload success');
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        console.error('Upload failed:', error);
                        // 😤 Handle upload errors
                    }
                });
            });


        });
    </script>

}