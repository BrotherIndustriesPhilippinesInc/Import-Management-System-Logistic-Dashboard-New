@model IEnumerable<LogisticDashboard.Core.ImportPICInformation>

@{
    ViewData["Title"] = "Index";

    // Convert to list for easier index access
    var items = Model.ToList();
    int i = 0;
}

<div class="mt-4">
    <div class="misc-color px-3 py-3 d-inline-flex mb-2 rounded align-items-center gap-2">
        <span class="text-light fs-2 fw-bold">Shipping Instructions</span>
    </div>
</div>

<p>
    <a asp-action="Create">Create New</a>
</p>

<table class="table">
    <thead>
        <tr>
            <th>Mode Of Shipment</th>
            <th>Supplier</th>
            <th>Main PIC</th>
            <th>Sub PIC</th>
            <th>Supervisor</th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        @while (i < items.Count)
        {
            var current = items[i];
            // Count how many consecutive rows have the same ModeOfShipment
            int rowspan = 1;
            for (int j = i + 1; j < items.Count; j++)
            {
                if (items[j].ModeOfShipment == current.ModeOfShipment)
                    rowspan++;
                else
                    break;
            }

            <tr>
                <td rowspan="@rowspan">
                    @Html.DisplayFor(modelItem => current.ModeOfShipment)
                </td>
                <td>@Html.DisplayFor(modelItem => current.Supplier)</td>
                <td>@Html.DisplayFor(modelItem => current.ShippingMainPICStaff)</td>
                <td>@Html.DisplayFor(modelItem => current.ShippingSubPICStaff)</td>
                <td>@Html.DisplayFor(modelItem => current.Supervisor)</td>
                <td>
                    <a asp-action="Edit" asp-route-id="@current.Id">Edit</a> |
                    <a asp-action="Details" asp-route-id="@current.Id">Details</a> |
                    <a asp-action="Delete" asp-route-id="@current.Id">Delete</a>
                </td>
            </tr>

            // Render the remaining rows without ModeOfShipment cell
            for (int j = 1; j < rowspan; j++)
            {
                var next = items[i + j];
                <tr>
                    <td>@Html.DisplayFor(modelItem => next.Supplier)</td>
                    <td>@Html.DisplayFor(modelItem => next.ShippingMainPICStaff)</td>
                    <td>@Html.DisplayFor(modelItem => next.ShippingSubPICStaff)</td>
                    <td>@Html.DisplayFor(modelItem => next.Supervisor)</td>
                    <td>
                        <a asp-action="Edit" asp-route-id="@next.Id">Edit</a> |
                        <a asp-action="Details" asp-route-id="@next.Id">Details</a> |
                        <a asp-action="Delete" asp-route-id="@next.Id">Delete</a>
                    </td>
                </tr>
            }

            i += rowspan;
        }
    </tbody>
</table>
